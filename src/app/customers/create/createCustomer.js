/*èª²é¡Œç”¨ãƒ¡ãƒ¢
ã¤ã¾ã‚Šã“ã“ã¯frontendã®createãƒšãƒ¼ã‚¸ã§å…¥åŠ›ã—ãŸã‚‚ã®ã‚’è¾æ›¸å‹ã«ã—ã¦
APIã«POSTãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦é€ä¿¡ã™ã‚‹å‡¦ç†ã‚’ã—ã¦ã„ã‚‹
èª²é¡Œã«ã‚ã£ãŸIDãŒç©ºã®çŠ¶æ…‹ã§é€ä¿¡ã•ã‚Œã‚‹ã®ã‚’é˜²ããŸã‚ã®å‡¦ç†ã¯
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã§pythonã®ãƒ«ãƒ¼ãƒ«ã¨ã—ã¦å®Ÿè£…ã™ã‚Œã°OKãªæ°—ãŒã™ã‚‹
app.pyã®POSTãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ/customersã®éƒ¨åˆ†
*/

"use server";// ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Œã‚µãƒ¼ãƒãƒ¼å´ã€ã§å‹•ãå‡¦ç†ã ã‚ˆã£ã¦Next.jsã«æ•™ãˆã¦ã‚‹ï¼
import { revalidatePath } from "next/cache";
// ãƒšãƒ¼ã‚¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ‰‹å‹•ã§å†èª­ã¿è¾¼ã¿ã™ã‚‹ãŸã‚ã®é–¢æ•°ã‚’èª­ã¿è¾¼ã‚“ã§ã‚‹
// ã“ã‚Œã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ãŸå¾Œã«ãƒšãƒ¼ã‚¸ã‚’æœ€æ–°ã®çŠ¶æ…‹ã«ã§ãã‚‹ã‚“ã ï¼

//ã“ã“ã§ formData ã¯ FormData ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã£ã¦ã„ã†**ã€Œãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒã¾ã¨ã¾ã£ãŸç®±ã€**ã¿ãŸã„ãªã‚‚ã®âœ¨
//inputã‚¿ã‚°ã® nameå±æ€§ ãŒã‚­ãƒ¼ã€å…¥åŠ›ã—ãŸå€¤ãŒãƒãƒªãƒ¥ãƒ¼ï¼ˆå€¤ï¼‰ã«ãªã£ã¦ã‚‹ã‚ˆï¼
const createCustomer = async (formData) => {// é¡§å®¢ã‚’æ–°ã—ãä½œã‚‹ãŸã‚ã®éåŒæœŸé–¢æ•°ã‚’å®šç¾©ã—ã¦ã‚‹ã‚ˆï¼ˆformDataãŒå¼•æ•°ï¼‰
  const creating_customer_name = formData.get("customer_name");// ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰åå‰ã®å€¤ã‚’å–å¾—ï¼ˆinputã‚¿ã‚°ã®nameå±æ€§ã«å¯¾å¿œï¼‰
  const creating_customer_id = formData.get("customer_id"); // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰IDã‚’å–å¾—
  const creating_age = formData.get("age"); // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰IDã‚’å–å¾—
  const creating_gender = formData.get("gender");// ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æ€§åˆ¥ã‚’å–å¾—

  const body_msg = JSON.stringify({// ä¸Šã§å–ã‚Šå‡ºã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã€JSONå½¢å¼ã®æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¦ã‚‹ã‚ˆï¼ˆAPIã«é€ã‚‹ãŸã‚ï¼‰
    customer_name: creating_customer_name,
    customer_id: creating_customer_id,
    age: creating_age,
    gender: creating_gender,
  });

  /*
  ğŸŒŸã“ã“ã§ã®ãƒã‚¤ãƒ³ãƒˆ
  ğŸ“„ formDataï¼ˆãƒ•ã‚©ãƒ¼ãƒ ã®ä¸­èº«ï¼‰
  ã€€â†“
  ğŸ å¿…è¦ãªæƒ…å ±ã ã‘ .get() ã§å–ã‚Šå‡ºã™
  ã€€â†“
  ğŸ§± ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ã¨ã‚ã¦
  ã€€â†“
  ğŸŒ€ JSON.stringify() ã§æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¦
  ã€€â†“
  ğŸ“® API ã«é€ã‚‹æº–å‚™å®Œäº†ï¼
  ğŸŒŸ
  */

   // APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ã¦ã‚‹
  const res = await fetch(process.env.NEXT_PUBLIC_API_ENDPOINT + `/customers`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },// JSONã‚’é€ã‚‹ã‚ˆã£ã¦ã„ã†ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®š
    body: body_msg,// å®Ÿéš›ã«é€ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆåå‰ãƒ»IDãƒ»å¹´é½¢ãƒ»æ€§åˆ¥ã®æƒ…å ±ï¼‰
  });
  if (!res.ok) {// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå¤±æ•—ã ã£ãŸã‚‰â€¦
    throw new Error("Failed to create customer");// ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã¦ã‚¹ãƒˆãƒƒãƒ—ã™ã‚‹ï¼ï¼ˆç™»éŒ²å¤±æ•—ï¼‰
  }

  revalidatePath(`/customers`);// `/customers` ãƒšãƒ¼ã‚¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°ï¼ˆæœ€æ–°ãƒ‡ãƒ¼ã‚¿ãŒåæ˜ ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ï¼‰
};

export default createCustomer;// ã“ã®é–¢æ•°ã‚’ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä½¿ãˆã‚‹ã‚ˆã†ã«å¤–ã«å‡ºã—ã¦ã‚‹ã‚ˆï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼‰

/*
ğŸŒˆã“ã®ã¾ã¾è¦šãˆã‚‹ã¨ã„ã„ã“ã¨âœ¨

formData.get("name") ã§ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›ãŒå–ã‚Œã‚‹

JSON.stringify() ã§é€ä¿¡ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’æ–‡å­—åˆ—åŒ–

fetch() ã§APIã¸é€ä¿¡

revalidatePath() ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã—ã¦ä¸€è¦§ã‚’æ–°ã—ãã™ã‚‹
*/
